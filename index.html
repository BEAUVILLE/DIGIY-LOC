<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>DIGIY LOC ‚Äî Locations direct propri√©taire</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Locations direct propri√©taire. 0% commission. DIGIY LOC.">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#020617;
  --card:#0b1220;
  --line:#1f2937;
  --ink:#f9fafb;
  --muted:#cbd5f5;
  --gold:#facc15;
  --green:#22c55e;
  --soft:rgba(255,255,255,.03);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:
    radial-gradient(900px 500px at 10% -10%, rgba(250,204,21,.12), transparent 60%),
    radial-gradient(900px 500px at 90% 0%, rgba(34,197,94,.10), transparent 60%),
    var(--bg);
  color:var(--ink);
}
.wrap{max-width:1100px;margin:0 auto}
header{padding:22px 16px 10px;text-align:center}
h1{margin:0;font-size:2.1rem;letter-spacing:.2px}
.tagline{margin:8px 0 0;color:var(--muted);font-size:1.02rem}
.pills{
  margin-top:12px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap;
}
.pill{
  border:1px solid var(--line);
  background:var(--soft);
  color:var(--muted);
  padding:7px 10px;
  border-radius:999px;
  font-weight:700;
  font-size:.92rem;
}
.status{
  margin:12px 16px 8px;
  padding:10px 12px;
  border:1px solid var(--line);
  border-radius:12px;
  color:var(--muted);
  background:var(--soft);
  white-space:pre-wrap;
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:14px;
  padding:16px;
}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:18px;
  padding:14px;
  transition:transform .08s ease, border-color .08s ease;
  cursor:pointer;
}
.card:hover{ transform:translateY(-2px); border-color:rgba(250,204,21,.45) }
.thumb{
  width:100%;
  height:170px;
  object-fit:cover;
  border-radius:16px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.04);
  display:block;
  margin-bottom:10px;
}
.topline{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.card h3{
  margin:0;
  font-size:1.18rem;
  line-height:1.2;
}
.badge{
  border:1px solid rgba(250,204,21,.35);
  background:rgba(250,204,21,.10);
  color:#fde68a;
  padding:6px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:.82rem;
  white-space:nowrap;
}
.meta{
  margin-top:6px;
  color:var(--muted);
  font-size:.95rem;
}
.desc{
  margin-top:10px;
  color:rgba(203,213,245,.92);
  font-size:.96rem;
  line-height:1.35;
}
.priceRow{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:10px;
  margin-top:10px;
}
.price{
  color:var(--gold);
  font-weight:950;
  font-size:1.08rem;
}
.small{
  color:var(--muted);
  font-weight:700;
  font-size:.9rem;
}
a.btn{
  display:block;
  margin-top:12px;
  text-align:center;
  padding:12px 12px;
  border-radius:14px;
  background:var(--green);
  color:#022c22;
  text-decoration:none;
  font-weight:950;
}
</style>
</head>

<body>
<div class="wrap">
  <header>
    <h1>üè° DIGIY LOC</h1>
    <div class="tagline">Ici, tu loues <b>direct propri√©taire</b>. Pas d‚Äôinterm√©diaire. Pas de commission.</div>

    <div class="pills">
      <div class="pill">‚ö° Simple & rapide</div>
      <div class="pill">üí¨ Contact direct</div>
      <div class="pill">üü° 0% commission</div>
    </div>
  </header>

  <div class="status" id="status">Chargement‚Ä¶</div>
  <div class="grid" id="grid"></div>
</div>

<script>
/* üîê SUPABASE */
const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

const SB = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const statusEl = document.getElementById("status");
const grid = document.getElementById("grid");

function setStatus(t){ statusEl.textContent = t; }
function esc(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function money(n){
  return Number(n||0).toLocaleString("fr-FR") + " FCFA";
}
function snippet(s, n=110){
  const t = String(s ?? "").trim().replace(/\s+/g," ");
  return t.length > n ? t.slice(0,n-1) + "‚Ä¶" : t;
}
function ficheUrl(id){ return `loc.html?id=${encodeURIComponent(id)}`; }

(async()=>{
  try{
    setStatus("On regarde ce qui est dispo‚Ä¶");

    const { data, error } = await SB
      .from("digiy_logements")
      .select("id,nom,ville,adresse,description,prix_nuit,photo_url,status,created_at")
      .in("status", ["actif","Actif","active","Active","published","Published","online","Online"])
      .order("created_at", { ascending:false })
      .limit(60);

    if(error){
      console.error(error);
      setStatus("Oups‚Ä¶ petit souci technique : " + error.message);
      return;
    }

    if(!data || data.length === 0){
      setStatus("Rien de dispo pour le moment. Reviens dans un instant, √ßa arrive. ü¶Ö");
      return;
    }

    // mini status plus chaleureux
    const villes = [...new Set(data.map(x => (x.ville||"").trim()).filter(Boolean))];
    const extra = villes.length ? ` ‚Ä¢ ${villes.slice(0,2).join(", ")}${villes.length>2?"‚Ä¶":""}` : "";
    setStatus(`‚úÖ ${data.length} logement(s) dispo${extra}`);

    data.forEach(l=>{
      const url = ficheUrl(l.id);

      const div = document.createElement("div");
      div.className = "card";
      div.setAttribute("role","link");
      div.setAttribute("tabindex","0");
      div.onclick = () => location.href = url;
      div.onkeydown = (e) => { if(e.key === "Enter") location.href = url; };

      const img = l.photo_url
        ? `<img class="thumb" loading="lazy" src="${esc(l.photo_url)}" alt="${esc(l.nom || "Logement")}">`
        : `<div class="thumb"></div>`;

      const meta = [l.ville, l.adresse].filter(Boolean).join(" ‚Ä¢ ");
      const desc = l.description ? `<div class="desc">${esc(snippet(l.description))}</div>` : "";

      div.innerHTML = `
        ${img}
        <div class="topline">
          <h3>${esc(l.nom || "Logement")}</h3>
          <div class="badge">Contact direct</div>
        </div>
        <div class="meta">${esc(meta)}</div>
        ${desc}
        <div class="priceRow">
          <div class="price">${money(l.prix_nuit)} <span class="small">/ nuit</span></div>
          <div class="small">0% commission</div>
        </div>
        <a class="btn" href="${url}" onclick="event.stopPropagation()">Voir la fiche</a>
      `;

      grid.appendChild(div);
    });

  }catch(e){
    console.error(e);
    setStatus("Erreur JS : " + (e.message || e));
  }
})();
</script>
</body>
</html>
