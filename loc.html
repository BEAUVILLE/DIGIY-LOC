<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>DIGIY LOC ‚Äî Fiche logement</title>
<meta name="viewport" content="width=device-width, initial-scale=1,viewport-fit=cover">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#020617; --card:#0b1220; --line:#1f2937;
  --ink:#f9fafb; --muted:#cbd5f5;
  --gold:#facc15; --green:#22c55e;
}
body{
  margin:0;font-family:system-ui,Segoe UI,Roboto,sans-serif;
  background:linear-gradient(180deg,#0b1020,#020617);
  color:var(--ink);
}
.wrap{max-width:980px;margin:0 auto;padding:14px}
.card{
  border:1px solid var(--line);
  background:rgba(255,255,255,.03);
  border-radius:18px;
  padding:14px;
  margin-bottom:14px;
}
.hero-photo{
  width:100%;
  height:auto;
  max-height:70vh;
  object-fit:contain;
  background:#020617;
  border-radius:16px;
}
h1{margin:10px 0 4px}
.muted{color:var(--muted)}
label{display:block;margin-top:10px;font-weight:800}
input{
  width:100%;padding:10px;border-radius:12px;
  border:1px solid var(--line);background:#020617;color:#fff;
}
.btn{
  margin-top:12px;
  width:100%;padding:12px;
  border-radius:14px;border:0;
  font-weight:900;
}
.btn.primary{background:var(--green);color:#022c22}
.note{
  margin-top:10px;padding:10px;border-radius:12px;
  border:1px solid var(--line);
}
.note.ok{border-color:#22c55e;color:#bbf7d0}
.note.bad{border-color:#ef4444;color:#fecaca}
.wave-box{
  margin-top:10px;
  padding:10px;border-radius:14px;
  border:1px solid var(--line);
  background:rgba(34,197,94,.08);
}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <img id="photo" class="hero-photo">
    <h1 id="nom">‚Äî</h1>
    <div class="muted" id="ville">‚Äî</div>
    <p id="desc"></p>
  </div>

  <div class="card">
    <h3>üìÖ R√©servation</h3>

    <label>Date arriv√©e</label>
    <input type="date" id="dateIn">

    <label>Date d√©part</label>
    <input type="date" id="dateOut">

    <label>Votre nom</label>
    <input id="clientName">

    <label>Votre t√©l√©phone</label>
    <input id="clientPhone">

    <div class="wave-box">
      <strong>üí≥ Acompte Wave</strong><br>
      B√©n√©ficiaire : <span id="waveName"></span><br>
      Num√©ro : <span id="wavePhone"></span><br>
      Acompte demand√© : <strong id="depositAmount">‚Äî</strong>
    </div>

    <label>R√©f√©rence Wave</label>
    <input id="waveRef" placeholder="ID transaction Wave">

    <button class="btn primary" id="btnConfirm">‚úÖ J‚Äôai pay√© l‚Äôacompte</button>
    <div id="status" class="note"></div>
  </div>
</div>

<script>
const SUPABASE_URL="https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";
const SB=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

const id=new URLSearchParams(location.search).get("id");
let logement=null;

function note(msg,type){
  const n=document.getElementById("status");
  n.className="note "+(type||"");
  n.textContent=msg;
}

function nights(){
  if(!dateIn.value||!dateOut.value) return 0;
  return (new Date(dateOut.value)-new Date(dateIn.value))/86400000;
}

async function load(){
  const {data}=await SB.from("digiy_logements").select("*").eq("id",id).single();
  logement=data;
  photo.src=logement.photo_url;
  nom.textContent=logement.nom;
  ville.textContent=logement.ville;
  desc.textContent=logement.description;
  waveName.textContent=logement.wave_name;
  wavePhone.textContent=logement.wave_phone;
}

function updateDeposit(){
  const amt=Math.round((nights()*logement.prix_nuit)*(logement.deposit_percent/100));
  depositAmount.textContent=amt?amt.toLocaleString("fr-FR")+" FCFA":"‚Äî";
}

[dateIn,dateOut].forEach(e=>e.onchange=updateDeposit);

btnConfirm.onclick=async()=>{
  if(!waveRef.value) return note("R√©f√©rence Wave obligatoire","bad");

  const payload={
    listing_id:logement.id,
    owner_id:logement.owner_id,
    client_name:clientName.value,
    client_phone:clientPhone.value,
    date_in:dateIn.value,
    date_out:dateOut.value,
    amount_expected:Math.round((nights()*logement.prix_nuit)*(logement.deposit_percent/100)),
    deposit_percent:logement.deposit_percent,
    payment_method:"wave",
    wave_phone:logement.wave_phone,
    wave_name:logement.wave_name,
    wave_tx_ref:waveRef.value,
    status:"pending"
  };

  const {error}=await SB.from("loc_payment_intents").insert(payload);
  if(error) return note("Erreur enregistrement","bad");
  note("Acompte d√©clar√©. Le propri√©taire va confirmer.","ok");
};

load();
</script>
</body>
</html>
üîµ 2Ô∏è‚É£ pro-loc.html ‚Äî ESPACE PRO (gestion acomptes)
üëâ √Ä placer dans le dossier PRO

html
Copier le code
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>DIGIY LOC PRO ‚Äî Acomptes</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:system-ui;background:#020617;color:#fff;padding:14px}
.card{border:1px solid #1f2937;border-radius:16px;padding:14px;margin-bottom:12px}
.btn{padding:8px 10px;border-radius:10px;border:0;font-weight:800;margin-right:6px}
.ok{background:#22c55e;color:#022c22}
.no{background:#ef4444;color:#fff}
</style>
</head>

<body>
<h1>üßæ Acomptes re√ßus</h1>
<div id="list"></div>

<script>
const SUPABASE_URL="https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";
const SB=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

async function load(){
  const {data}=await SB.from("loc_payment_intents").select("*").order("created_at",{ascending:false});
  list.innerHTML="";
  data.forEach(d=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`
      <strong>${d.client_name}</strong><br>
      ${d.amount_expected} FCFA ‚Äî ${d.wave_tx_ref}<br>
      ${d.date_in} ‚Üí ${d.date_out}<br>
      Statut : ${d.status}<br><br>
      <button class="btn ok" onclick="update('${d.id}','confirmed')">Confirmer</button>
      <button class="btn no" onclick="update('${d.id}','rejected')">Refuser</button>
    `;
    list.appendChild(div);
  });
}

async function update(id,status){
  await SB.from("loc_payment_intents").update({status}).eq("id",id);
  load();
}

load();
</script>
</body>
</html>
